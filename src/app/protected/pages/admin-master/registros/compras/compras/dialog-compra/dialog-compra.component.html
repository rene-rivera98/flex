<!-- titulo de dialog -->
<h1 mat-dialog-title>

  <div class="text-center">

    <h1>DETALLE DE COMPRA</h1>

  </div>

</h1>


<!-- inicio contenido del dialog -->
<div mat-dialog-content class="custom-dialog">

  <!-- inicio de formulario -->
  <form autocomplete="off" [formGroup]="FormDialogCompra">

    <mat-tab-group mat-align-tabs="center">

      <mat-tab label="Proveedor y Productos">
        
        <form [formGroup]="formulario" class="mt-3">
     
          <!-- PROVEEDOR Y TIPO DE REGISTRO -->
          <div class="row col-13 mx-auto">

            <!-- SELECT PROVEEDOR -->
            <div class="col">
              <div class="form-floating mb-3">
                <select class="form-control" id="proveedor" formControlName="Proveedor">
                  <option disabled selected>Seleccione el proveedor</option>
                </select>
                
                <label for="proveedor">Proveedor</label>
              </div>
            </div>
            <!-- FIN SELECT PROVEEDOR --> 

            <!-- PRODUCTOS -->
            <div class="col">

              <form [formGroup]="productosForm">

                <div class="form-floating mb-3">

                  <select class="form-control" id="productos" formControlName="Productos">
                    <option disabled selected>Seleccione un producto</option>
                    <option value=""></option>
                  </select>

                  <label for="productos">Productos</label>
                </div>

              </form>

            </div>
            <!-- FIN PRODUCTOS -->         

            <!-- BOTONES PRODUCTO -->
            <div class="col">
              <div class="d-flex align-items-center mt-2">
                  <button class="btn btn-warning mx-auto col-6" (click)="agregarProducto()">
                      Agregar
                  </button>
                  
                  <button class="btn btn-danger mx-2 col-6 " (click)="eliminarUltimaFila()">
                      Quitar
                  </button>
              </div>
            </div>
            <!-- FIN BOTONES -->

          </div>

          <!------------------------- AGREGAR PRODUCTOS O SERVICIOS -------------------------------------->
          
          <div class="row col-13 mx-auto">

            <table #tablaCompras class="table table-striped table-bordered">
              <thead class="thead-dark">
                <tr>
                  <th>Lista de compra:</th>
                </tr>

              </thead>
                <tbody>
                  <!-- aquí se agregarán los productos o servicios -->
                </tbody>
            </table>
            
          </div>   
        </form>
        
      </mat-tab>

      <mat-tab label="Datos de la factura y Datos de pago">
          <!------------------------------- DATOS DE FACTURA ----------------------------------------------------------------------------------->

              <!-- FILA DE INPUT REFERENCIA, CFDI Y FECHA FACTURA-->

              <div class="row mt-3 col-13 mx-auto">

                <!-- INPUT REFERENCIA -->
                <div class="col">
                  <div class="form-floating mb-3">
                    <input class="form-control" id="folio" type="text" formControlName="Folio" placeholder="Folio"/>

                    <label for="folio">Folio</label>
                  </div>
                </div>
                <!-- FIN INPUT REFERENCIA -->

                <!-- INPUT CFDI -->
                <div class="col">
                  <div class="form-floating mb-3">
                    <input class="form-control" id="cfdi" type="text" formControlName="UsoCFDI" placeholder="Uso de CFDI"/>

                    <label for="cfdi">Uso de CFDI</label>
                  </div>
                </div>
                <!-- FIN INPUT CFDI -->

                <!-- INPUT FECHA FACTURA -->
                <div class="col">
                  <div class="form-floating mb-3">
                    <input class="form-control" id="fecha_factura" type="date" formControlName="Fechafactura"/>

                    <label for="fecha_factura">Fecha de factura</label>
                  </div>
                </div>
                <!-- FIN INPUT FECHA FACTURA -->
              </div>
            <!-- FIN FILA -->

          <!-- FILA DE INPUT MONTO DE LA FACTURA-->
          <div class="row col-13 mx-auto mb-2">

            <!-- INPUT SUBTOTAL -->
            <div class="col">
              <div class="form-floating mb-3">
                <input class="form-control" id="subtotal" type="number" 
                       formControlName="Subtotal" placeholder="Subtotal" 
                       step="0.01" min="0" max="100000"/>
                <label for="subtotal">Subtotal</label>
                <div *ngIf="FormDialogCompra.get('Subtotal')?.invalid && (FormDialogCompra.get('Subtotal')?.dirty || FormDialogCompra.get('Subtotal')?.touched)"></div>
                  <div *ngIf="FormDialogCompra.get('Subtotal')?.errors?.['pattern']">El subtotal debe ser numérico</div>
              </div>
            </div>
            <!-- FIN INPUT SUBTOTAL -->

            <!-- INPUT IVA -->
            <div class="col">
              <div class="form-floating mb-3">
                <input class="form-control" id="iva" type="number"
                    formControlName="IVA" placeholder="IVA" />

                <label for="iva">IVA</label>
              </div>
            </div>
            <!-- FIN INPUT IVA -->

            <!-- INPUT ISR -->
            <div class="col">
              <div class="form-floating mb-3">
                <input class="form-control" id="inputISR" type="number"
                    formControlName="ISR" placeholder="ISR"/>

                <label for="inputISR">ISR</label>
              </div>
            </div>
            <!-- FIN INPUT ISR -->

            <!-- INPUT IEPS -->
            <div class="col">
              <div class="form-floating mb-3">
                <input class="form-control" id="inputIEPS" type="number"
                    formControlName="IEPS" placeholder="IEPS"/>
                
                    <label for="inputIEPS">IEPS</label>
              </div>
            </div>
            <!-- FIN INPUT IEPS -->

            <!-- INPUT TOTAL -->
              <div class="col">
                <div class="form-floating mb-3">
                  <input class="form-control" id="inputTotal" type="number"
                      formControlName="Total" placeholder="Total"/>

                  <label for="inputTotal">Total</label>
                </div>
              </div>
            <!-- FIN INPUT TOTAL -->
          </div>
          <!-- FIN FILA DE INPUT MONTO DE LA FACTURA -->

          <!-- SEPARADOR -->
          <div class="row col-13 mx-auto">
            <div class="col">
              <mat-divider>
              </mat-divider>    
            </div>
          </div>
          <!-- FIN SEPARADOR -->

          <form [formGroup]="formulario" class="mt-4"> <!-- INICIO FORMULARIO PARA LLAMAR LA FUNCION onChangeMetodoDePago()-->

            <div class="row col-13 mx-auto">
              <div class="col">
                  <!-- SELECT METODO DE PAGO -->
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <select class="form-control" id="selectMetodoPago" 
                            formControlName="metodoDePago" 
                            (change)="onChangeMetodoDePago()">
                      <option disabled selected>Selecciona un metodo de pago</option>
                      <option value="Pago en una exhibición (PUE)">Pago en una exhibición (PUE)</option>
                      <option value="Pago diferido (PPD)">Pago diferido (PPD)</option>
                    </select>

                    <label for="selectMetodoPago">Metodo de pago</label>
                  </div>
                  <!-- FIN SELECT METODO DE PAGO -->
              </div>
            </div>
            

            <!-- DIV PAGO -->
            <div *ngIf="mostrarPago">

              <div class="row mx-auto">

                <!-- SELECT ESTADO DE PAGO -->
                <div class="col">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <select class="form-control" id="selectPago" formControlName="Pago" placeholder="Pago" (change)="onPagoChange()">
                      <option value="" disabled selected>Selecciona el estado del pago</option>
                      <option value="Pendiente">Pendiente</option>
                      <option value="Pagado">Pagado</option>
                    </select>

                    <label for="selectPago">Pago</label>
                  </div>
                </div>
                <!-- FIN SELECT ESTADO DE PAGO -->

                <!-- INPUT FECHA DE PAGO -->
                <div class="col" id="fechaPago" *ngIf="mostrarFechaPago">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <input class="form-control" id="inputFechaPago" type="date"
                        formControlName="FechaPago" placeholder="Fecha de pago"/>

                    <label for="inputFechaPago">Fecha de pago</label>
                  </div>
                </div>
                <!-- FIN INPUT FECHA DE PAGO -->

                <!-- SELECT FORMA DE PAGO -->
                <div class="col" id="formaPago" *ngIf="mostrarFormaPago">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <select class="form-control" id="selectFormaPago" formControlName="FormaPago" placeholder="Forma de pago">
                      <option value="" disabled selected>Selecciona la forma de pago</option>
                      <option value="Efectivo">Efectivo</option>
                      <option value="Transferencia">Transferencia</option>
                      <option value="Tarjeta de credito">Tarjeta de credito</option>
                      <option value="Tarjeta de debito">Tarjeta de debito</option>
                      <option value="Otro">Otro</option>
                    </select>

                    <label for="selectFormaPago">Forma de pago</label>
                  </div>
                </div>
                <!-- FIN SELECT FORMA DE PAGO -->
                
              </div> 
              <!-- FIN ROW -->
            </div>
            <!-- FIN DIV PAGO -->
            

            <!-- DIV COMPLEMENTO DE PAGO -->
            <div *ngIf="mostrarComplemento">

              <div class="row mx-auto">

                <!-- SELECT COMPLEMENTO DE PAGO -->
                <div class="col">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <select class="form-control" id="selectComplementoPago" formControlName="ComplementoPago" placeholder="Complemento de pago" (change)="onComplementoChange()">
                      <option value="" disabled selected>Selecciona el estado del complemento de pago</option>
                      <option value="Pendiente">Pendiente</option>
                      <option value="Finalizado">Finalizado</option>
                    </select>
                    
                    <label for="selectComplementoPago">Complemento de pago</label>
                  </div>
                </div>
                <!-- FIN SELECT COMPLEMENTO DE PAGO -->

                <!-- INPUT FECHA DE PAGO EN PENDIENTE -->
                <div class="col" id="fechaPagoPendiente" *ngIf="mostrarFechaPagoPendiente">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <input class="form-control" id="inputfechaPagoPendiente" type="date"
                          formControlName="FechaPagoPendiente" placeholder="Fecha de pago"/>
                    
                    <label for="inputFechaPagoPendiente">Fecha de pago</label>
                  </div>
                </div>
                <!-- FIN INPUT FECHA DE PAGO PENDIENTE -->

                <!-- INPUT MONTO DE PAGO PENDIENTE-->
                <div class="col" id="MontoPendiente" *ngIf="mostrarMontoPendiente">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <input class="form-control" id="inputMontoPendiente" type="number"
                            formControlName="MontoPendiente" placeholder="Monto" />

                    <label for="inputMontoPendiente">Monto</label>
                  </div>
                </div>
                <!-- FIN INPUT MONTO DE PAGO PENDIENTE -->

                <!-- INPUT PAGO INSOLUTO (CALCULO DE LO QUE RESTA DE TOTAL CON EL MONTO)-->
                <div class="col" id="PagoInsoluto" *ngIf="mostrarPagoInsoluto">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <input class="form-control" id="inputPagoInsoluto" type="number"
                            formControlName="PagoInsoluto" placeholder="Saldo insoluto" readonly/>

                    <label for="inputPagoInsoluto">Saldo insoluto</label>
                  </div>
                </div>
                <!-- FIN INPUT MONTO DE PAGO PENDIENTE -->

                <!-- DIVISION PAGO PENDIENTE Y FINALIZADO -->

                <!-- INPUT FECHA DE RECIBIDO -->
                <div class="col" id="fechaRecibido" *ngIf="mostrarFechaRecibido">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <input class="form-control" id="inputFechaRecibido" type="date"
                          formControlName="FechaRecibido" placeholder="Fecha de recibido"/>
                    
                    <label for="inputFechaRecibido">Fecha de recibido</label>
                  </div>
                </div>
                <!-- FIN INPUT FECHA DE RECIBIDO -->

                <!-- INPUT MONTO DE PAGO -->
                <div class="col" id="Monto" *ngIf="mostrarMonto">
                  <div class="form-floating mb-3 col-13 mx-auto">
                    <input class="form-control" id="inputMonto" type="number"
                            formControlName="Monto" placeholder="Monto" />

                    <label for="inputMonto">Monto</label>
                  </div>
                </div>
                <!-- FIN INPUT MONTO DE PAGO -->
              </div>
              <!-- FIN ROW -->
            </div>
            <!-- FIN DIV COMPLEMENTO DE PAGO-->

          </form> 
          <!-- CIERRA EL FORM = 'formulario' -->
      </mat-tab>

      <mat-tab label="Datos del producto y Clasificación">
          <!------------------------------- DATOS DEL PRODUCTO --------------------------------------------------------------------------------->
          <div class="row mt-3 mb-2 col-13 mx-auto">

            <!-- SELECT RECEPCION -->
            <div class="col">
              <div class="form-floating mb-3 col-13 mx-auto">
                <select class="form-control" id="status_recepcion" formControlName="Recepción" (change)="onRecepcionChange()">
                  <option disabled selected>Seleccione el estado de recepción</option>
                  <option value="Recibido">Recibido</option>
                  <option value="Pendiente">Pendiente</option>
                </select>

                <label for="status_recepcion">Estado de recepción</label>
              </div>
            </div>
            <!-- FIN SELECT RECEPCION -->

            <!-- INPUT FECHA DE RECEPCIÓN -->
            <div class="col" *ngIf="mostrarFechaRecepcion"> <!-- SE MOSTRARA SI ES QUE SE SELECCIONA RECIBIDO EN EL SELECT ANTERIOR -->
              <div class="form-floating mb-3 col-13 mx-auto">
                <input class="form-control" id="fecha_recepcion" type="date"
                      formControlName="FechaRecepción" placeholder="Fecha de recepción"/>
                
                <label for="fecha_recepcion">Fecha de recepción</label>
              </div>
            </div>
            <!-- FIN INPUT FECHA DE RECEPCIÓN -->

          </div>
          <!-- FIN ROW -->
          <!-- SEPARADOR -->
          <div class="row col-13 mx-auto">
            <div class="col">
              <mat-divider>
              </mat-divider>    
            </div>
          </div>
          <!------------------------------- CLASIFICACION -------------------------------------------------------------------------------------->
          <div class="row mt-4 col-13 mx-auto mb-5">

            <!-- INPUT SUCURSAL -->
            <div class="col">
              <div class="form-floating mb-3 col-13 mx-auto">
                <select class="form-control" id="selectSucursal" formControlName="Sucursal">
                  <option disabled selected>Seleccione una sucursal</option>
                  <option value=""></option>
                </select>
                
                <label for="selectSucursal">Sucursal</label>
              </div>
            </div>
            <!-- FIN INPUT SUCURSAL-->

            <!-- INPUT TIPO DE EGRESO -->
            <div class="col">
              <div class="form-floating mb-3 col-13 mx-auto">
                <select class="form-control" id="selectTipoEgreso" formControlName="TipoEgreso">
                  <option disabled selected>Seleccione el tipo de egreso</option>
                  <option value="Gasto">Gasto</option>
                  <option value="Compra">Compra</option>
                  <option value="Activo">Activo</option>
                </select>
                
                <label for="selectTipoEgreso">Tipo de egreso</label>
              </div>
            </div>
            <!-- FIN INPUT TIPO DE EGRESO -->

          </div>
          <!-- FIN ROW -->

      <!------------------------------- BOTONES CERRAR Y REGISTRAR ------------------------------------------------------------------------->
            <div class="row col-13 mx-auto">

              <div class="col">
                <div class="d-flex align-items-center mt-4">
                  <button class="btn btn-warning mx-auto col-6" type="submit">
                    Registrar
                  </button>
                </div>
              </div>
              
              <div class="col">
                <div class="d-flex align-items-center mt-4">
                  <button type="button" class="btn btn-danger mx-auto col-4" (click)="dialogRef.close()">
                    Cerrar
                  </button>
                </div>
              </div>
              
            </div>
            <!-- FIN DIV BOTONES -->

      </mat-tab>

      
    </mat-tab-group>

  </form>
  
</div>
<!-- FIN CONTENIDO DE DIALOG -->